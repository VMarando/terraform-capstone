#!/bin/bash
set -e

LOCAL_DIR="/var/www/html/videos"
TMP_HTML="/tmp/index.html"

# 1) Gather file names
FILES=$(ls -1 "$LOCAL_DIR")

# 2) Start the HTML
cat <<HTML_START > "$TMP_HTML"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Private Video Library</title>
</head>
<body>
  <h1>Video Library</h1>
  <ul>
HTML_START

# 3) Insert <li> entries for each file
if [ -z "$FILES" ]; then
  echo "    <p>No videos available at this time.</p>" >> "$TMP_HTML"
else
  for object in $FILES; do
    echo "    <li><a href='/videos/$object'>$object</a></li>" >> "$TMP_HTML"
  done
fi

# 4) Close the HTML
cat <<HTML_END >> "$TMP_HTML"
  </ul>
</body>
</html>
HTML_END

# 5) Move to final location
mv "$TMP_HTML" /var/www/html/index.html
